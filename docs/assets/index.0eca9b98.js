const w=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}};w();let b=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,o)=>(o&=63,o<36?t+=o.toString(36):o<62?t+=(o-26).toString(36).toUpperCase():o>62?t+="-":t+="_",t),"");const a=document.querySelector(".canvas-draw"),c=a.getContext("2d"),l=document.querySelector(".canvas-cursor"),L=l.getContext("2d"),x=document.querySelector(".toolbar");let C=document.querySelector(".toolbar-item.selected");const E=document.querySelector(".color-panel"),p=700;let f,d="marker",m=null,y="#000",h=10;function S(){a.width=p,a.height=p,l.width=p,l.height=p,c.lineCap="round",c.lineJoin="round",c.lineWidth=h}function g(){c.clearRect(0,0,a.width,a.height);const e=f.getRoot().paths;Object.keys(e).forEach(t=>{const{points:o,strokeStyle:r,lineWidth:n}=e[t];c.beginPath(),c.strokeStyle=r,c.lineWidth=n,o.forEach((s,i)=>{if(i===0)c.moveTo(s.x,s.y);else{const u=o[i-1],v={x:(u.x+s.x)/2,y:(u.y+s.y)/2};c.quadraticCurveTo(u.x,u.y,v.x,v.y)}}),c.stroke(),c.closePath()})}function P(){x.addEventListener("click",e=>{D(e)}),E.addEventListener("click",e=>{I(e)}),l.addEventListener("mousedown",e=>{M(e)}),l.addEventListener("mousemove",e=>{O(e)}),l.addEventListener("mouseup",e=>{k()}),l.addEventListener("mouseout",e=>{q()}),document.body.addEventListener("mouseup",e=>{k()})}function D(e){const t=e.target.closest(".toolbar-item");if(!t)return;const o=document.querySelector(".toolbar-item.selected");o!==t&&(C=t,d=t.getAttribute("data-mode"),d==="marker"?(y=t.getAttribute("data-color"),h=10):d==="eraser"&&(y="#fff",h=100),o.classList.remove("selected"),t.classList.add("selected"))}function I(e){if(d!=="marker")return;const t=e.target.closest(".color-pick");if(!t)return;const o=t.getAttribute("data-color");y=o,C.style.fill=o,C.setAttribute("data-color",o)}function M(e){m=b();const t={};t.mode=d,t.strokeStyle=y,t.lineWidth=h;const o={x:e.offsetX,y:e.offsetY},r={x:e.offsetX+.001,y:e.offsetY+.001};t.points=[o,r],f.update(n=>{n.paths[m]=t}),g()}function O(e){A(e),m&&(f.update(t=>{const o=t.paths[m],r={x:e.offsetX,y:e.offsetY};o.points.push(r)}),g())}function k(e){m=null}function q(e){B()}function A(e){const t=L;t.clearRect(0,0,a.width,a.height),t.lineWidth=1,t.strokeStyle="gray";const o=h/2,r=e.offsetX,n=e.offsetY;t.beginPath(),t.arc(r,n,o,0,Math.PI*2,!0),t.stroke()}function B(){L.clearRect(0,0,a.width,a.height)}function R(e,t,o){return`
  <svg 
    class="cursor"
    style="transform: translateX(${t}px) translateY(${o}px)" 
    width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"
  >
    <path fill=${e} stroke="#FEFDFB" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" d="M19.83 9.1571C20.5067 8.89395 20.845 8.76237 20.94 8.57633C21.0223 8.41515 21.0198 8.22375 20.9333 8.06478C20.8335 7.8813 20.4918 7.75864 19.8084 7.51333L2.379 1.2566C1.81992 1.0559 1.54037 0.955556 1.35762 1.01884C1.19874 1.07387 1.07387 1.19873 1.01884 1.35762C0.955555 1.54037 1.0559 1.81992 1.2566 2.379L7.51328 19.8085C7.75859 20.4918 7.88124 20.8335 8.06473 20.9333C8.22369 21.0198 8.41509 21.0224 8.57627 20.9401C8.76231 20.8451 8.89389 20.5067 9.15705 19.83L12.0055 12.5054C12.0571 12.3728 12.0829 12.3065 12.1227 12.2507C12.1579 12.2013 12.2012 12.158 12.2507 12.1227C12.3065 12.0829 12.3728 12.0571 12.5053 12.0056L19.83 9.1571Z"/>
  </svg>
  `}function T(e,t){const o=Object.entries(e),r=["#DC2626","#D97706","#059669","#7C3AED","#DB2777"];document.getElementById("cursorContainer")&&document.getElementById("cursorContainer").remove();const n=document.createElement("div");n.id="cursorContainer",n.innerHTML=o.map(([s,{point:i}],u)=>{if(s!==t&&!!i)return R(r[u],i.x,i.y)}).join(""),document.body.appendChild(n)}async function W(){const e=new yorkie.Client("https://api.yorkie.dev",{apiKey:"cd430gkqfu97mhl4kmr0"});await e.activate();const t=e.getID(),o=new yorkie.Document("painting");await e.attach(o),f=o,f.update(r=>{r.paths||(r.paths={})}),e.subscribe(r=>{if(r.type==="peers-changed"){const n=r.value[o.getKey()];document.getElementById("peersCount").innerHTML=Object.entries(n).length,T(n,t)}}),o.subscribe(r=>{r.type!=="local-change"&&g()}),document.body.addEventListener("mousemove",r=>{e.updatePresence("point",{x:r.clientX,y:r.clientY})}),document.body.addEventListener("mouseleave",()=>{e.updatePresence("point",null)})}async function X(){S(),P(),await W(),g()}X();
